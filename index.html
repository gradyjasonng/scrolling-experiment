<!doctype html>
<html lang="en">
   <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      <title>Scrolling Experiment</title>
      <meta name="author" content="Grady Jason Ng">
      <link rel="apple-touch-icon" sizes="180x180" href="./apple-touch-icon.png">
      <link rel="icon" type="image/png" sizes="32x32" href="./favicon-32x32.png">
      <link rel="icon" type="image/png" sizes="16x16" href="./favicon-16x16.png">
      <link rel="manifest" href="./site.webmanifest">
      <link rel="mask-icon" href="./safari-pinned-tab.svg" color="#ff5800">
      <meta name="msapplication-TileColor" content="#b91d47">
      <meta name="theme-color" content="#ffffff">
      <style>
         body{
            scroll-behavior: smooth;
         }
         #Wrapper{
            margin-right: auto;
            margin-left: auto;
            width: 80%;
            overflow-x: hidden;
         }
         .highlight, .target{
            background-color: yellow;
         }
         .target:hover{
            opacity: 0.2;
         }
      </style>
   </head>
   <body>
      <div id="Wrapper">
        <span id="passage"></span>
      </div>
      <script type="text/javascript">
        window.onload = function () {
            console.log("loading");
             'use strict';

             window.scrollTo(0,0);

             var passage, text;

             text = "<p>Tell me, Muse, of that man of many resources, who wandered far and wide, after sacking the holy citadel of Troy. Many the men whose cities he saw, whose ways he learned. Many the sorrows he suffered at sea, while trying to bring himself and his friends back alive. Yet despite his wishes he failed to save them, because of their own un-wisdom, foolishly eating the cattle of Helios, the Sun, so the god denied them their return. Tell us of these things, beginning where you will, Goddess, Daughter of Zeus.</p><p>Now, all the others, who had escaped destruction, had reached their homes, and were free of sea and war. He alone, longing for wife and home, Calypso, the Nymph, kept in her echoing cavern, desiring him for a husband. Not even when the changing seasons brought the year the gods had chosen for his return to Ithaca was he free from danger, and among friends. Yet all the gods pitied him, except Poseidon, who continued his relentless anger against godlike Odysseus until he reached his own land at last.</p><p>Now, though, Poseidon was visiting the distant Ethiopians, the most remote of all, a divided people, some of whom live where Hyperion sets the others where he rises, to accept a hetacomb of sacrificial bulls and rams, and there he sat, enjoying the feast: but the rest of the gods had gathered in the halls of Olympian Zeus. The Father of gods and men was first to address them, for he was thinking of flawless Aegisthus, whom far-famed Orestes, Agamemnon’s son had killed. And, thinking of him, he spoke to the immortals.</p><p>‘How surprising that men blame the gods, and say their troubles come from us, though they, through their own un-wisdom, find suffering beyond what is fated. Just as Aegisthus, beyond what was fated, took the wife of Agamemnon, son of Atreus, and murdered him when he returned, though he knew the end would e a complete disaster, since we sent Hermes, keen-eyed slayer of Argus, to warn him not to kill the man, or court his wife, as Orestes would avenge Agamemnon, once he reached manhood and longed for his own land. So Hermes told him, but despite his kind intent he could not move Aegisthus’ heart: and Aegisthus has paid the price now for it all.’</p><p>Athene, the bright-eyed goddess, answered him at once: ‘Father of us all, Son of Cronos, Highest King, clearly that man deserved to be destroyed: so let all be destroyed who act as he did. But my heart aches for Odysseus, wise but ill fated, who suffers far from his friends on an island deep in the sea. The island is densely wooded and a goddess lives there, a child of malevolent Atlas, he who knows the depths of the sea, and supports the great columns that separate earth and sky. It is his daughter who detains that unlucky, sorrowful man: she lulls him, always, with soft seductive words, intending him to forget Ithaca. But Odysseus, who yearns for the mere sight of the smoke rising from his own country, only longs to die. Yet, Olympian, your heart is unmoved. Did he win no favour with the sacrifices he made you, by the Argive ships, on the wide plains of Troy? Why do you will this man such pain, Zeus?’</p><p>Cloud-Gathering Zeus answered her then: ‘My child, what words escape your lips? How could I ever forget godlike Odysseus, who exceeds all mortals in wisdom, and also in sacrifice to the deathless gods who inhabit the broad heavens? It is Poseidon, the Earth-Bearer, who is always filled with implacable anger against him, because of godlike Polyphemus, the strongest Cyclops of all, whom Odysseus blinded. The nymph Thoosa bore him, daughter of Phorcys who rules the barren sea: she slept with Poseidon in the hollow caves. Since that blinding, Poseidon, the Earth-Shaker, though he will not kill him, keeps Odysseus far from his native land. Come, let all here plan how he might come home: then Poseidon will relent, since he’ll not be able to contend, alone, against all the deathless gods together.’</p><p>The goddess, bright-eyed Athene, answered him: ‘Father of us all, Son of Cronos, Highest King, if it truly pleases the blessed gods for wise Odysseus to return home, let us send Hermes, the Messenger, Slayer of Argus, to the isle of Ogygia, so he can tell the Nymph with the lovely tresses of our unalterable decision, that long-suffering Odysseus may come home. Meanwhile I will go to Ithaca, to stir his son, and encourage him to call the long-haired Achaeans together, and speak his mind to the Suitors who slaughter his flocks of sheep, and his shambling cattle with twisted horns. Then I will lead him to Sparta and sandy Pylos to gain news of his loyal father’s return, if he can, and so win praise.’</p>"
             passage = document.getElementById('passage');
             passage.innerHTML = text;

             function updateTarget(word, n){
                passage.innerHTML = passage.innerHTML.replace(new RegExp( word +"[^\\w]", 'g' ), function(match){
                    return "<span class='highlight'>" + match + "</span>";
                });
                document.querySelectorAll(".highlight")[n-1].setAttribute("class", "target");
             }

             updateTarget("Odysseus", 2)

             var view, indicator, relative, min, max, offset, multiplier = 1.5 , reference, pressed, xform,velocity, frame, timestamp, ticker, amplitude, target, timeConstant;

             function ypos(e) {
                 // touch event
                 if (e.targetTouches && (e.targetTouches.length >= 1)) {
                     return e.targetTouches[0].clientY;
                 }

                 // mouse event
                 return e.clientY;
             }

             function scroll(y) {
                 offset = (y > max) ? max : (y < min) ? min : y;
                 view.style[xform] = 'translateY(' + -(offset) + 'px)';
                 // indicator.style[xform] = 'translateY(' + (offset * relative) + 'px)';
             }

             function track() {
                 console.log("tracking")
                 var now, elapsed, delta, v;

                 now = Date.now();
                 elapsed = now - timestamp;
                 timestamp = now;
                 delta = offset - frame;
                 frame = offset;

                 v = 1000 * delta / (1 + elapsed);
                 velocity = 0.8 * v + 0.2 * velocity;
             }

             function autoScroll() {
                 var elapsed, delta;
                 if (amplitude) {
                     elapsed = Date.now() - timestamp;
                     delta = -amplitude * Math.exp(-elapsed / timeConstant);
                     if (delta > 0.5 || delta < -0.5) {
                         scroll(target + delta);
                         requestAnimationFrame(autoScroll);
                     } else {
                         scroll(target);
                     }
                 }
             }

              function tap(e) {
                 pressed = true;
                 reference = ypos(e);

                 velocity = amplitude = 0;
                 frame = offset;
                 timestamp = Date.now();
                 clearInterval(ticker);
                 ticker = setInterval(track, 50);

                 e.preventDefault();
                 e.stopPropagation();
                 return false;
             }

             function drag(e) {
                 var y, delta;
                 if (pressed) {
                     y = ypos(e);
                     delta = reference - y;
                     if (delta > 2 || delta < -2) {
                         reference = y;
                         scroll(offset + delta*multiplier);
                     }
                 }
                 e.preventDefault();
                 e.stopPropagation();
                 return false;
             }

             function release(e) {
                 pressed = false;

                 clearInterval(ticker);
                 if (velocity > 5 || velocity < -5) {
                     amplitude = 0.8 * multiplier * velocity;
                     target = Math.round(offset + amplitude);
                     timestamp = Date.now();
                     requestAnimationFrame(autoScroll);
                 }
                 e.preventDefault();
                 e.stopPropagation();
                 return false;
             }
             view = document.getElementById('Wrapper');
             if (typeof window.ontouchstart !== 'undefined') {
                 view.addEventListener('touchstart', tap);
                 view.addEventListener('touchmove', drag);
                 view.addEventListener('touchend', release);
             }
             view.addEventListener('mousedown', tap);
             view.addEventListener('mousemove', drag);
             view.addEventListener('mouseup', release);

             max = parseInt(getComputedStyle(view).height, 10) - innerHeight;
             offset = min = 0;
             pressed = false;
             timeConstant = 325; // ms

             // indicator = document.getElementById('indicator');
             // relative = (innerHeight - 30) / max;

             xform = 'transform';
             ['webkit', 'Moz', 'O', 'ms'].every(function (prefix) {
                 var e = prefix + 'Transform';
                 if (typeof view.style[e] !== 'undefined') {
                     xform = e;
                     return false;
                 }
                 return true;
             });



        };
      </script>

   </body>
</html>
